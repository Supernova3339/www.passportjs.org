<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
  <head>
    <title>Documentation: Strategies</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="canonical" href="https://www.passportjs.org/concepts/authentication/strategies/">
    <link rel="manifest" href="/manifest.webmanifest"/>
    <meta name="theme-color" content="#35DF79"/>
    <link rel="shortcut icon" href="/images/favicon/favicon.ico"/>
    <link rel="icon" sizes="16x16" type="image/png" href="/images/favicon/favicon-16x16.png"/>
    <link rel="icon" sizes="32x32" type="image/png" href="/images/favicon/favicon-32x32.png"/>
    <link rel="icon" sizes="36x36" type="image/png" href="/images/favicon/android-icon-36x36.png"/>
    <link rel="icon" sizes="48x48" type="image/png" href="/images/favicon/android-icon-48x48.png"/>
    <link rel="icon" sizes="70x70" type="image/png" href="/images/favicon/ms-icon-70x70.png"/>
    <link rel="icon" sizes="72x72" type="image/png" href="/images/favicon/android-icon-72x72.png"/>
    <link rel="icon" sizes="96x96" type="image/png" href="/images/favicon/android-icon-96x96.png"/>
    <link rel="icon" sizes="144x144" type="image/png" href="/images/favicon/ms-icon-144x144.png"/>
    <link rel="icon" sizes="150x150" type="image/png" href="/images/favicon/ms-icon-150x150.png"/>
    <link rel="icon" sizes="192x192" type="image/png" href="/images/favicon/android-icon-192x192.png"/>
    <link rel="icon" sizes="310x310" type="image/png" href="/images/favicon/ms-icon-310x310.png"/>
    <link rel="apple-touch-icon" href="/images/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png"/>
    <meta name="msapplication-config" content="/browserconfig.xml"/>
    <meta name="msapplication-TileColor" content="#35DF79"/>
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="Documentation: Strategies"/>
    <meta property="og:url" content="https://www.passportjs.org/concepts/authentication/strategies/"/>
    <meta property="og:image" content="https://www.passportjs.org/images/facebook-card.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:site_name" content="Passport.js"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@passportjs"/>
    <meta name="twitter:title" content="Documentation: Strategies"/>
    <meta name="twitter:image" content="https://www.passportjs.org/images/twitter-card.png"/>
    <meta name="flattr:id" content="d5znvd"/>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-73332146-2', 'auto');
      ga('send', 'pageview');
    </script>
    <!--+google-tag-manager('GTM-M5S3PH')-->
    <!--link(type='text/css', rel='stylesheet', href='http://fast.fonts.net/cssapi/7527d73a-ebfe-45db-a201-ff2812df4b18.css')-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <link rel="stylesheet" href="/assets/styles/all.css">
    <script data-main="/script/main" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.js"></script>
  </head>
  <body>
    <div id="container"><span id="top"></span>
      <div id="toolbar">
        <div class="toolbar-search">
          <form action="/search">
            <button type="submit"></button>
            <input type="text" name="q" placeholder="Search for Strategies">
          </form>
        </div>
        <div class="toolbar-social">
          <ul>
            <li class="facebook"><a href="https://www.facebook.com/passportjs" target="_blank"></a></li>
            <li class="twitter"><a href="https://twitter.com/passportjs" target="_blank"></a></li>
            <li class="github"><a href="https://github.com/jaredhanson/passport" target="_blank"><span class="count">0</span></a></li>
          </ul>
        </div>
      </div>
      <nav id="menu"><a class="menu-logo" href="/" title="Passport.js"></a>
        <div class="menu-trigger"><span></span></div>
        <div class="menu-items">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="/features/">Features</a></li>
            <li><a href="/packages/">Strategies</a></li>
          </ul><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=passportjsorg" id="_carbonads_js"></script>
        </div>
      </nav>
      <div id="content">
        <div class="book" id="book">
          <div class="toc">
            <nav data-accordion-group="">
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/middleware/"></a>General</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/middleware/">Middleware</a></li>
                  <li><a class="active" href="/concepts/authentication/strategies/">Strategies</a></li>
                  <li><a href="/concepts/authentication/password/">Username &amp; Password</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/facebook/"></a>Social</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/facebook/">Facebook</a></li>
                  <li><a href="/concepts/authentication/google/">Google</a></li>
                  <li><a href="/concepts/authentication/twitter/">Twitter</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/oauth/"></a>Federated</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/oauth/">OAuth</a></li>
                  <li><a href="/concepts/authentication/openid/">OpenID</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/login/"></a>Sessions</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/login/">Log In</a></li>
                  <li><a href="/concepts/authentication/logout/">Log Out</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/http-bearer/"></a>API</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/http-bearer/">Bearer</a></li>
                  <li><a href="/concepts/authentication/http-oauth/">OAuth</a></li>
                  <li><a href="/concepts/authentication/http-basic/">Basic</a></li>
                </ul>
              </div>
            </nav>
          </div><a id="go-top" href="#top"><i class="icon-budicon-462"></i></a>
          <div class="contents">
            <section class="chapter"><h1 id="strategies">Strategies</h1>
<p>Strategies are responsible for authenticating requests, which they accomplish by
implementing an authentication mechanism.  Authentication mechanisms define how
to encode a credential, such as a password or an assertion from an identity
provider (IdP), in a request.  They also specify the procedure necessary to
verify that credential.  If the credential is successfully verified, the request
is authenticated.</p>
<p>There are a wide variety of authentication mechanisms, and a corresponding
variety of strategies.  Strategies are distributed in separate packages which
must be installed, configured, and registered.</p>
<h2 id="install">Install</h2>
<p>Strategies are published to the <a href="https://www.npmjs.com/">npm</a> registry, and
installed using a package manager.</p>
<p>For example, the following command will install <a href="https://www.passportjs.org/packages/passport-local/"><code>passport-local</code></a>,
a package which provides a strategy for authenticating with a username and
password:</p>
<pre><code class="lang-bash">$ npm install passport-local
</code></pre>
<p>And the following command will install <a href="https://www.passportjs.org/packages/passport-openidconnect/"><code>passport-openidconnect</code></a>,
a package which implements support for <a href="https://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect</a>:</p>
<pre><code class="lang-bash">$ npm install passport-openidconnect
</code></pre>
<p>Developers only need to install the packages which provide authentication
mechanisms required by the application.  These packages are then configured and
plugged into Passport.  This reduces overall application size by avoiding
unnecessary dependencies.</p>
<h2 id="configure">Configure</h2>
<p>Once a package has been installed, the strategy needs to be configured.  The
configuration varies with each authentication mechanism, so strategy-specific
documentation should be consulted.  That being said, there are common patterns
that are encountered across many strategies.</p>
<p>The following code is an example that configures the <code>LocalStrategy</code>:</p>
<pre><code class="lang-javascript"><span class="keyword">var</span> LocalStrategy = <span class="built_in">require</span>(<span class="string">'passport-local'</span>);

<span class="keyword">var</span> strategy = <span class="keyword">new</span> LocalStrategy(<span class="function"><span class="keyword">function</span> <span class="title">verify</span>(<span class="params">username, password, cb</span>) </span>{
  db.get(<span class="string">'SELECT * FROM users WHERE username = ?'</span>, [ username ], <span class="function"><span class="keyword">function</span>(<span class="params">err, user</span>) </span>{
    <span class="keyword">if</span> (err) { <span class="keyword">return</span> cb(err); }
    <span class="keyword">if</span> (!user) { <span class="keyword">return</span> cb(<span class="literal">null</span>, <span class="literal">false</span>, { <span class="attr">message</span>: <span class="string">'Incorrect username or password.'</span> }); }

    crypto.pbkdf2(password, user.salt, <span class="number">310000</span>, <span class="number">32</span>, <span class="string">'sha256'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, hashedPassword</span>) </span>{
      <span class="keyword">if</span> (err) { <span class="keyword">return</span> cb(err); }
      <span class="keyword">if</span> (!crypto.timingSafeEqual(user.hashed_password, hashedPassword)) {
        <span class="keyword">return</span> cb(<span class="literal">null</span>, <span class="literal">false</span>, { <span class="attr">message</span>: <span class="string">'Incorrect username or password.'</span> });
      }
      <span class="keyword">return</span> cb(<span class="literal">null</span>, user);
    });
  });
});
</code></pre>
<h4 id="verify-function">Verify Function</h4>
<p>The <code>LocalStrategy</code> constructor takes a function as an argument.  This function
is known as a <code>verify</code> function, and is a common pattern in many strategies.
When authenticating a request, a strategy parses the credential contained in the
request.  A <code>verify</code> function is then called, which is responsible for
determining the user to which that credential belongs.  This allows data access
to be delegated to the application.</p>
<p>In this particular example, the <code>verify</code> function is executing a SQL query to
obtain a user record from the database and, after verifying the password,
yielding the record back to the strategy, thus authenticating the user and
establishing a login session.</p>
<p>Because a <code>verify</code> function is supplied by the application itself, access to
persistent storage is not constrained in any way.  The application is free to
use any data storage system, including relational databases, graph databases,
or document stores, and structure data within that database according to any
schema.</p>
<p>A <code>verify</code> function is strategy-specific, and the exact arguments it receives
and parameters it yields will depend on the underlying authentication mechanism.
For authentication mechanisms involving shared secrets, such as a password, a
<code>verify</code> function is responsible for verifying the credential and yielding a
user.  For mechanisms that provide cryptographic authentication, a <code>verify</code>
function will typically yield a user and a key, the later of which the strategy
will use to cryptographically verify the credential.</p>
<p>A <code>verify</code> function yields under one of three conditions: success, failure, or
an error.</p>
<p>If the <code>verify</code> function finds a user to which the credential belongs, and that
credential is valid, it calls the callback with the authenticating user:</p>
<pre><code class="lang-javascript"><span class="keyword">return</span> cb(<span class="literal">null</span>, user);
</code></pre>
<p>If the credential does not belong to a known user, or is not valid, the <code>verify</code>
function calls the callback with <code>false</code> to indicate an authentication failure:</p>
<pre><code class="lang-javascript"><span class="keyword">return</span> cb(<span class="literal">null</span>, <span class="literal">false</span>);
</code></pre>
<p>If an error occurs, such as the database not being available, the callback is
called with an error, in idiomatic Node.js style:</p>
<pre><code class="lang-javascript"><span class="keyword">return</span> cb(err);
</code></pre>
<p>It is important to distinguish between the two failure cases that can occur.
Authentication failures are expected conditions, in which the server is
operating normally, even though invalid credentials are being received from the
user (or a malicious adversary attempting to authenticate as the user).  Only
when the server is operating abnormally should <code>err</code> be set, to indicate an
internal error.</p>
<h2 id="register">Register</h2>
<p>With the strategy configured, it is then registered by calling <code>.use()</code>:</p>
<pre><code class="lang-javascript"><span class="keyword">var</span> passport = <span class="built_in">require</span>(<span class="string">'passport'</span>);

passport.use(strategy);
</code></pre>
<p>All strategies have a name which, by convention, corresponds to the package
name according to the pattern <code>passport-{name}</code>.  For instance, the
<code>LocalStrategy</code> configured above is named <code>local</code> as it is distributed in the
<code>passport-local</code> package.</p>
<p>Once registered, the strategy can be employed to authenticate a request by
passing the name of the strategy as the first argument to <code>passport.authenticate()</code>
middleware:</p>
<pre><code class="lang-javascript">app.post(<span class="string">'/login/password'</span>,
  passport.authenticate(<span class="string">'local'</span>, { <span class="attr">failureRedirect</span>: <span class="string">'/login'</span>, <span class="attr">failureMessage</span>: <span class="literal">true</span> }),
  <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>{
    res.redirect(<span class="string">'/~'</span> + req.user.username);
  });
</code></pre>
<p>In cases where there is a naming conflict, or the default name is not
sufficiently descriptive, the name can be overridden when registering the
strategy by passing a name as the first argument to <code>.use()</code>:</p>
<pre><code class="lang-javascript"><span class="keyword">var</span> passport = <span class="built_in">require</span>(<span class="string">'passport'</span>);

passport.use(<span class="string">'password'</span>, strategy);
</code></pre>
<p>That name is then specified to <code>passport.authenticate()</code> middleware:</p>
<pre><code class="lang-javascript">app.post(<span class="string">'/login/password'</span>,
  passport.authenticate(<span class="string">'password'</span>, { <span class="attr">failureRedirect</span>: <span class="string">'/login'</span>, <span class="attr">failureMessage</span>: <span class="literal">true</span> }),
  <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>{
    res.redirect(<span class="string">'/~'</span> + req.user.username);
  });
</code></pre>
<p>For brevity, strategies are often configured and registered in a single
statement:</p>
<pre><code class="lang-javascript"><span class="keyword">var</span> passport = <span class="built_in">require</span>(<span class="string">'passport'</span>);
<span class="keyword">var</span> LocalStrategy = <span class="built_in">require</span>(<span class="string">'passport-local'</span>);

passport.use(<span class="keyword">new</span> LocalStrategy(<span class="function"><span class="keyword">function</span> <span class="title">verify</span>(<span class="params">username, password, cb</span>) </span>{
  <span class="comment">// ...</span>
});
</code></pre>
</section>
          </div>
        </div>
      </div>
    </div>
    <div class="search-con">
      <div class="head"><span class="close-ico"></span>
        <div class="hold">
          <h2>SEARCH FOR STRATEGIES</h2>
          <form action="/">
            <input value="" type="text" name="strategy" placeholder="Start typing" autocomplete="off">
          </form>
          <p class="info-line"><span>0</span>STRATEGIES</p>
        </div>
      </div>
      <div class="results">
        <section></section>
      </div>
    </div>
    <!--+google-tag-manager-noscript('GTM-M5S3PH')-->
  </body>
</html>