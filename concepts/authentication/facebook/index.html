<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
  <head>
    <title>Documentation: Facebook</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="canonical" href="https://www.passportjs.org/concepts/authentication/facebook/">
    <link rel="manifest" href="/manifest.webmanifest"/>
    <meta name="theme-color" content="#35DF79"/>
    <link rel="shortcut icon" href="/images/favicon/favicon.ico"/>
    <link rel="icon" sizes="16x16" type="image/png" href="/images/favicon/favicon-16x16.png"/>
    <link rel="icon" sizes="32x32" type="image/png" href="/images/favicon/favicon-32x32.png"/>
    <link rel="icon" sizes="36x36" type="image/png" href="/images/favicon/android-icon-36x36.png"/>
    <link rel="icon" sizes="48x48" type="image/png" href="/images/favicon/android-icon-48x48.png"/>
    <link rel="icon" sizes="70x70" type="image/png" href="/images/favicon/ms-icon-70x70.png"/>
    <link rel="icon" sizes="72x72" type="image/png" href="/images/favicon/android-icon-72x72.png"/>
    <link rel="icon" sizes="96x96" type="image/png" href="/images/favicon/android-icon-96x96.png"/>
    <link rel="icon" sizes="144x144" type="image/png" href="/images/favicon/ms-icon-144x144.png"/>
    <link rel="icon" sizes="150x150" type="image/png" href="/images/favicon/ms-icon-150x150.png"/>
    <link rel="icon" sizes="192x192" type="image/png" href="/images/favicon/android-icon-192x192.png"/>
    <link rel="icon" sizes="310x310" type="image/png" href="/images/favicon/ms-icon-310x310.png"/>
    <link rel="apple-touch-icon" href="/images/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png"/>
    <meta name="msapplication-config" content="/browserconfig.xml"/>
    <meta name="msapplication-TileColor" content="#35DF79"/>
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="Documentation: Facebook"/>
    <meta property="og:url" content="https://www.passportjs.org/concepts/authentication/facebook/"/>
    <meta property="og:image" content="https://www.passportjs.org/images/facebook-card.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:site_name" content="Passport.js"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@passportjs"/>
    <meta name="twitter:title" content="Documentation: Facebook"/>
    <meta name="twitter:image" content="https://www.passportjs.org/images/twitter-card.png"/>
    <meta name="flattr:id" content="d5znvd"/>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-73332146-2', 'auto');
      ga('send', 'pageview');
    </script>
    <!--+google-tag-manager('GTM-M5S3PH')-->
    <!--link(type='text/css', rel='stylesheet', href='http://fast.fonts.net/cssapi/7527d73a-ebfe-45db-a201-ff2812df4b18.css')-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <link rel="stylesheet" href="/assets/styles/all.css">
    <script data-main="/script/main" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.js"></script>
  </head>
  <body>
    <div id="container"><span id="top"></span>
      <div id="toolbar">
        <div class="toolbar-search">
          <form action="/search">
            <button type="submit"></button>
            <input type="text" name="q" placeholder="Search for Strategies">
          </form>
        </div>
        <div class="toolbar-social">
          <ul>
            <li class="facebook"><a href="https://www.facebook.com/passportjs" target="_blank"></a></li>
            <li class="twitter"><a href="https://twitter.com/passportjs" target="_blank"></a></li>
            <li class="github"><a href="https://github.com/jaredhanson/passport" target="_blank"><span class="count">0</span></a></li>
          </ul>
        </div>
      </div>
      <nav id="menu"><a class="menu-logo" href="/" title="Passport.js"></a>
        <div class="menu-trigger"><span></span></div>
        <div class="menu-items">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="/features/">Features</a></li>
            <li><a href="/packages/">Strategies</a></li>
            <li><a href="/sponsors/">Sponsors</a></li>
          </ul><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=passportjsorg" id="_carbonads_js"></script>
        </div>
      </nav>
      <div id="content">
        <div class="book" id="book">
          <div class="toc">
            <nav data-accordion-group="">
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/middleware/"></a>General</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/middleware/">Middleware</a></li>
                  <li><a href="/concepts/authentication/strategies/">Strategies</a></li>
                  <li><a href="/concepts/authentication/sessions/">Sessions</a></li>
                  <li><a href="/concepts/authentication/password/">Username &amp; Password</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/facebook/"></a>Social</h5>
                <ul data-content="">
                  <li><a class="active" href="/concepts/authentication/facebook/">Facebook</a></li>
                  <li><a href="/concepts/authentication/google/">Google</a></li>
                  <li><a href="/concepts/authentication/twitter/">Twitter</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/oauth/"></a>Federated</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/oauth/">OAuth</a></li>
                  <li><a href="/concepts/authentication/openid/">OpenID</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/login/"></a>Sessions</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/login/">Log In</a></li>
                  <li><a href="/concepts/authentication/logout/">Log Out</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/http-bearer/"></a>API</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/http-bearer/">Bearer</a></li>
                  <li><a href="/concepts/authentication/http-oauth/">OAuth</a></li>
                  <li><a href="/concepts/authentication/http-basic/">Basic</a></li>
                </ul>
              </div>
            </nav>
          </div><a id="go-top" href="#top"><i class="icon-budicon-462"></i></a>
          <div class="contents">
            <section class="chapter"><h1 id="facebook">Facebook</h1>
<p><a href="https://developers.facebook.com/docs/facebook-login/">Facebook Login</a> allows
users to sign in using their Facebook account.  Support for Faceboook Login is
provided by the <a href="https://www.passportjs.org/packages/passport-facebook/"><code>passport-facebook</code></a>
package.</p>
<h2 id="install">Install</h2>
<p>To install <code>passport-facebook</code>, execute the following command:</p>
<pre><code class="bash">$ npm install passport-facebook
</code></pre>
<h2 id="configure">Configure</h2>
<p>Before your application can make use of Facebook Login, you must register your
app with Facebook.  This can be done in the <a href="https://developers.facebook.com/apps">App dashboard</a>
at <a href="https://developers.facebook.com/">Facebook for Developers</a>.  Once
registered, your app will be issued an app ID and secret which will be used in
the strategy configuration.</p>
<p>The following code is an example that configures and registers the
<code>FacebookStrategy</code>:</p>
<pre><code class="javascript"><span class="keyword">var</span> passport = <span class="built_in">require</span>(<span class="string">&#x27;passport&#x27;</span>);
<span class="keyword">var</span> <span class="title class_">FacebookStrategy</span> = <span class="built_in">require</span>(<span class="string">&#x27;passport-facebook&#x27;</span>);

passport.<span class="title function_">use</span>(<span class="keyword">new</span> <span class="title class_">FacebookStrategy</span>({
    <span class="attr">clientID</span>: process.<span class="property">env</span>[<span class="string">&#x27;FACEBOOK_APP_ID&#x27;</span>],
    <span class="attr">clientSecret</span>: process.<span class="property">env</span>[<span class="string">&#x27;FACEBOOK_APP_SECRET&#x27;</span>],
    <span class="attr">callbackURL</span>: <span class="string">&#x27;https://www.example.com/oauth2/redirect/facebook&#x27;</span>
  },
  <span class="keyword">function</span>(<span class="params">accessToken, refreshToken, profile, cb</span>) {
    db.<span class="title function_">get</span>(<span class="string">&#x27;SELECT * FROM federated_credentials WHERE provider = ? AND subject = ?&#x27;</span>, [
      <span class="string">&#x27;https://www.facebook.com&#x27;</span>,
      profile.<span class="property">id</span>
    ], <span class="keyword">function</span>(<span class="params">err, cred</span>) {
      <span class="keyword">if</span> (err) { <span class="keyword">return</span> <span class="title function_">cb</span>(err); }
      <span class="keyword">if</span> (!cred) {
        <span class="comment">// The Facebook account has not logged in to this app before.  Create a</span>
        <span class="comment">// new user record and link it to the Facebook account.</span>
        db.<span class="title function_">run</span>(<span class="string">&#x27;INSERT INTO users (name) VALUES (?)&#x27;</span>, [
          profile.<span class="property">displayName</span>
        ], <span class="keyword">function</span>(<span class="params">err</span>) {
          <span class="keyword">if</span> (err) { <span class="keyword">return</span> <span class="title function_">cb</span>(err); }

          <span class="keyword">var</span> id = <span class="variable language_">this</span>.<span class="property">lastID</span>;
          db.<span class="title function_">run</span>(<span class="string">&#x27;INSERT INTO federated_credentials (user_id, provider, subject) VALUES (?, ?, ?)&#x27;</span>, [
            id,
            <span class="string">&#x27;https://www.facebook.com&#x27;</span>,
            profile.<span class="property">id</span>
          ], <span class="keyword">function</span>(<span class="params">err</span>) {
            <span class="keyword">if</span> (err) { <span class="keyword">return</span> <span class="title function_">cb</span>(err); }
            <span class="keyword">var</span> user = {
              <span class="attr">id</span>: id.<span class="title function_">toString</span>(),
              <span class="attr">name</span>: profile.<span class="property">displayName</span>
            };
            <span class="keyword">return</span> <span class="title function_">cb</span>(<span class="literal">null</span>, user);
          });
        });
      } <span class="keyword">else</span> {
        <span class="comment">// The Facebook account has previously logged in to the app.  Get the</span>
        <span class="comment">// user record linked to the Facebook account and log the user in.</span>
        db.<span class="title function_">get</span>(<span class="string">&#x27;SELECT * FROM users WHERE id = ?&#x27;</span>, [ cred.<span class="property">user_id</span> ], <span class="keyword">function</span>(<span class="params">err, user</span>) {
          <span class="keyword">if</span> (err) { <span class="keyword">return</span> <span class="title function_">cb</span>(err); }
          <span class="keyword">if</span> (!user) { <span class="keyword">return</span> <span class="title function_">cb</span>(<span class="literal">null</span>, <span class="literal">false</span>); }
          <span class="keyword">return</span> <span class="title function_">cb</span>(<span class="literal">null</span>, user);
        });
      }
    };
  }
));
</code></pre>
<p>The options to the <code>FacebookStrategy</code> constructor must include a <code>clientID</code> and
<code>clientSecret</code>, the values of which are set to the app ID and secret that were
obtained when registering your application.  A <code>callbackURL</code> must also be
included.  Facebook will redirect users to this location after they have
authenticated.  The path of this URL must match the route defined below.</p>
<p>The <code>verify</code> function accepts an <code>accessToken</code>, <code>refreshToken</code> and <code>profile</code> as
arguments.  <code>accessToken</code> and <code>refreshToken</code> are used for API access, and are
not needed for authentication.  <code>profile</code> is a <a href="/guide/profile/">normalized</a>
profile containing information provided by Facebook about the user who is
signing in.</p>
<p>The <code>verify</code> function is responsible for determining the user to which the
Facebook account belongs.  The first time that account is used to sign in, a new
user record is typically created automatically using profile information
supplied by Facebook, and that record is then linked to the Facebook account.
On subsequent signins, the existing user record will be found via its relation
to the Facebook account.</p>
<p>Linking social accounts to a user record is recommended, as it allows users to
link multiple social accounts from other providers in the event that they stop
using Facebook.  Alternatively, the user could set up a credential, such as a
password, for their user account at your app.  Either feature allows the user to
continue to sign in to your application independent of their Facebook account.</p>
<p>The example above illustrates usage of a SQL database to find or create a user
record and link it to a Facebook account.  However, because the <code>verify</code>
function is supplied by the application, the application is free to use a
database and schema of its choosing.</p>
<p>Internally, Facebook Login is implemented using <a href="https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow">OAuth 2.0</a>.
As such, the strategy configuration is able to make use of additional options
and functionality provided by the base <a href="/docs/oauth/">OAuth 2.0 strategy</a>.</p>
<h2 id="prompt">Prompt</h2>
<p>Place a button on the application&#39;s login page, prompting the user to sign in
with Facebook.</p>
<pre><code class="html"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/login/facebook&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span>&gt;</span>Log In With Facebook<span class="tag">&lt;/<span class="name">a</span>&gt;</span>
</code></pre>
<p>Define a route that, when the button is clicked, will redirect the user to
Facebook, where they will authenticate.</p>
<pre><code class="javascript">app.<span class="title function_">get</span>(<span class="string">&#x27;/login/facebook&#x27;</span>, passport.<span class="title function_">authenticate</span>(<span class="string">&#x27;facebook&#x27;</span>));
</code></pre>
<p>If your application needs additional permissions from the user, they can be
requested with the <code>scope</code> option:</p>
<pre><code class="javascript">app.<span class="title function_">get</span>(<span class="string">&#x27;/login/facebook&#x27;</span>, passport.<span class="title function_">authenticate</span>(<span class="string">&#x27;facebook&#x27;</span>, {
  <span class="attr">scope</span>: [ <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;user_location&#x27;</span> ]
}));
</code></pre>
<h2 id="authenticate">Authenticate</h2>
<p>After the user has authenticated with Facebook, they will be redirected back
to your application.  Define a route which will handle this redirect.</p>
<pre><code><span class="selector-tag">app</span><span class="selector-class">.get</span>(<span class="string">&#x27;/oauth2/redirect/facebook&#x27;</span>,
  passport.<span class="built_in">authenticate</span>(<span class="string">&#x27;facebook&#x27;</span>, { <span class="attribute">failureRedirect</span>: <span class="string">&#x27;/login&#x27;</span>, <span class="attribute">failureMessage</span>: true }),
  <span class="built_in">function</span>(req, res) {
    <span class="selector-tag">res</span><span class="selector-class">.redirect</span>(<span class="string">&#x27;/&#x27;</span>);
  });
</code></pre><p>When a request to this route is processed, the strategy will authenticate the
fact that the user signed in with Facebook and obtain that user&#39;s profile
information.  If authentication succeeds, <code>passport.authenticate()</code> middleware
calls the next function in the stack.  In this example, the function is
redirecting the authenticated user to the home page.</p>
<p>When authentication fails, the user is re-prompted to sign in and informed that
their initial attempt was not successful.  This is accomplished by using the
<code>failureRedirect</code> option, which will redirect the user to the login page, along
with the <code>failureMessage</code> option which will add the message to
<code>req.session.messages</code>.</p>
<p>The path of this route should be the value supplied for the <code>callbackURL</code> option
in the strategy configuration above.</p>
</section>
          </div>
        </div>
      </div>
    </div>
    <div class="search-con">
      <div class="head"><span class="close-ico"></span>
        <div class="hold">
          <h2>SEARCH FOR STRATEGIES</h2>
          <form action="/">
            <input value="" type="text" name="strategy" placeholder="Start typing" autocomplete="off">
          </form>
          <p class="info-line"><span>0</span>STRATEGIES</p>
        </div>
      </div>
      <div class="results">
        <section></section>
      </div>
    </div>
    <!--+google-tag-manager-noscript('GTM-M5S3PH')-->
  </body>
</html>