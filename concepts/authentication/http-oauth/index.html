<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
  <head>
    <title>Documentation: OAuth</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="canonical" href="https://www.passportjs.org/concepts/authentication/http-oauth/">
    <link rel="manifest" href="/manifest.webmanifest"/>
    <meta name="theme-color" content="#35DF79"/>
    <link rel="shortcut icon" href="/images/favicon/favicon.ico"/>
    <link rel="icon" sizes="16x16" type="image/png" href="/images/favicon/favicon-16x16.png"/>
    <link rel="icon" sizes="32x32" type="image/png" href="/images/favicon/favicon-32x32.png"/>
    <link rel="icon" sizes="36x36" type="image/png" href="/images/favicon/android-icon-36x36.png"/>
    <link rel="icon" sizes="48x48" type="image/png" href="/images/favicon/android-icon-48x48.png"/>
    <link rel="icon" sizes="70x70" type="image/png" href="/images/favicon/ms-icon-70x70.png"/>
    <link rel="icon" sizes="72x72" type="image/png" href="/images/favicon/android-icon-72x72.png"/>
    <link rel="icon" sizes="96x96" type="image/png" href="/images/favicon/android-icon-96x96.png"/>
    <link rel="icon" sizes="144x144" type="image/png" href="/images/favicon/ms-icon-144x144.png"/>
    <link rel="icon" sizes="150x150" type="image/png" href="/images/favicon/ms-icon-150x150.png"/>
    <link rel="icon" sizes="192x192" type="image/png" href="/images/favicon/android-icon-192x192.png"/>
    <link rel="icon" sizes="310x310" type="image/png" href="/images/favicon/ms-icon-310x310.png"/>
    <link rel="apple-touch-icon" href="/images/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png"/>
    <meta name="msapplication-config" content="/browserconfig.xml"/>
    <meta name="msapplication-TileColor" content="#35DF79"/>
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="Documentation: OAuth"/>
    <meta property="og:url" content="https://www.passportjs.org/concepts/authentication/http-oauth/"/>
    <meta property="og:image" content="https://www.passportjs.org/images/facebook-card.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:site_name" content="Passport.js"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@passportjs"/>
    <meta name="twitter:title" content="Documentation: OAuth"/>
    <meta name="twitter:image" content="https://www.passportjs.org/images/twitter-card.png"/>
    <meta name="flattr:id" content="d5znvd"/>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-73332146-2', 'auto');
      ga('send', 'pageview');
    </script>
    <!--+google-tag-manager('GTM-M5S3PH')-->
    <!--link(type='text/css', rel='stylesheet', href='http://fast.fonts.net/cssapi/7527d73a-ebfe-45db-a201-ff2812df4b18.css')-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <link rel="stylesheet" href="/assets/styles/all.css">
    <script data-main="/script/main" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.js"></script>
  </head>
  <body>
    <div id="container"><span id="top"></span>
      <div id="toolbar">
        <div class="toolbar-search">
          <form action="/search">
            <button type="submit"></button>
            <input type="text" name="q" placeholder="Search for Strategies">
          </form>
        </div>
        <div class="toolbar-social">
          <ul>
            <li class="facebook"><a href="https://www.facebook.com/passportjs" target="_blank"></a></li>
            <li class="twitter"><a href="https://twitter.com/passportjs" target="_blank"></a></li>
            <li class="github"><a href="https://github.com/jaredhanson/passport" target="_blank"><span class="count">0</span></a></li>
          </ul>
        </div>
      </div>
      <nav id="menu"><a class="menu-logo" href="/" title="Passport.js"></a>
        <div class="menu-trigger"><span></span></div>
        <div class="menu-items">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="/features/">Features</a></li>
            <li><a href="/packages/">Strategies</a></li>
            <li><a href="/sponsors/">Sponsors</a></li>
          </ul><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=passportjsorg" id="_carbonads_js"></script>
        </div>
      </nav>
      <div id="content">
        <div class="book" id="book">
          <div class="toc">
            <nav data-accordion-group="">
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/middleware/"></a>General</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/middleware/">Middleware</a></li>
                  <li><a href="/concepts/authentication/strategies/">Strategies</a></li>
                  <li><a href="/concepts/authentication/sessions/">Sessions</a></li>
                  <li><a href="/concepts/authentication/password/">Username &amp; Password</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/facebook/"></a>Social</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/facebook/">Facebook</a></li>
                  <li><a href="/concepts/authentication/google/">Google</a></li>
                  <li><a href="/concepts/authentication/twitter/">Twitter</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/oauth/"></a>Federated</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/oauth/">OAuth</a></li>
                  <li><a href="/concepts/authentication/openid/">OpenID</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/login/"></a>Sessions</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/login/">Log In</a></li>
                  <li><a href="/concepts/authentication/logout/">Log Out</a></li>
                </ul>
              </div>
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/authentication/http-bearer/"></a>API</h5>
                <ul data-content="">
                  <li><a href="/concepts/authentication/http-bearer/">Bearer</a></li>
                  <li><a class="active" href="/concepts/authentication/http-oauth/">OAuth</a></li>
                  <li><a href="/concepts/authentication/http-basic/">Basic</a></li>
                </ul>
              </div>
            </nav>
          </div><a id="go-top" href="#top"><i class="icon-budicon-462"></i></a>
          <div class="contents">
            <section class="chapter"><h1 id="oauth">OAuth</h1>
<p><a href="http://oauth.net/">OAuth</a> (formally specified by <a href="http://tools.ietf.org/html/rfc5849">RFC 5849</a>)
provides a means for users to grant third-party applications access to their
data without exposing their password to those applications.</p>
<p>The protocol greatly improves the security of web applications, in particular,
and OAuth has been important in bringing attention to the potential dangers of
exposing passwords to external services.</p>
<p>While OAuth 1.0 is still widely used, it has been superseded by <a href="/guide/oauth2-api/">OAuth 2.0</a>.
It is recommended to base new implementations on OAuth 2.0.</p>
<p>When using OAuth to protect API endpoints, there are three distinct steps that
that must be performed:</p>
<ol>
<li>The application requests permission from the user for access to protected
resources.</li>
<li>A token is issued to the application, if permission is granted by the user.</li>
<li>The application authenticates using the token to access protected
resources.</li>
</ol>
<h2 id="issuing-tokens">Issuing Tokens</h2>
<p><a href="https://github.com/jaredhanson/oauthorize">OAuthorize</a>, a sibling project to
Passport, provides a toolkit for implementing OAuth service providers.</p>
<p>The authorization process is a complex sequence that involves authenticating
both the requesting application and the user, as well as prompting the user for
permission, ensuring that enough detail is provided for the user to make an
informed decision.</p>
<p>Additionally, it is up to the implementor to determine what limits can be placed
on the application regarding scope of access, as well as subsequently enforcing
those limits.</p>
<p>As a toolkit, OAuthorize does not attempt to make implementation decisions.
This guide does not cover these issues, but does highly recommend that
services deploying OAuth have a complete understanding of the security
considerations involved.</p>
<h2 id="authenticating-tokens">Authenticating Tokens</h2>
<p>Once issued, OAuth tokens can be authenticated using the <a href="https://github.com/jaredhanson/passport-http-oauth">passport-http-oauth</a>
module.</p>
<h2 id="install">Install</h2>
<pre><code class="bash">$ npm install passport-http-oauth
</code></pre>
<h2 id="configuration">Configuration</h2>
<pre><code class="javascript">passport.<span class="title function_">use</span>(<span class="string">&#x27;token&#x27;</span>, <span class="keyword">new</span> <span class="title class_">TokenStrategy</span>(
  <span class="keyword">function</span>(<span class="params">consumerKey, done</span>) {
    <span class="title class_">Consumer</span>.<span class="title function_">findOne</span>({ <span class="attr">key</span>: consumerKey }, <span class="keyword">function</span> (<span class="params">err, consumer</span>) {
      <span class="keyword">if</span> (err) { <span class="keyword">return</span> <span class="title function_">done</span>(err); }
      <span class="keyword">if</span> (!consumer) { <span class="keyword">return</span> <span class="title function_">done</span>(<span class="literal">null</span>, <span class="literal">false</span>); }
      <span class="keyword">return</span> <span class="title function_">done</span>(<span class="literal">null</span>, consumer, consumer.<span class="property">secret</span>);
    });
  },
  <span class="keyword">function</span>(<span class="params">accessToken, done</span>) {
    <span class="title class_">AccessToken</span>.<span class="title function_">findOne</span>({ <span class="attr">token</span>: accessToken }, <span class="keyword">function</span> (<span class="params">err, token</span>) {
      <span class="keyword">if</span> (err) { <span class="keyword">return</span> <span class="title function_">done</span>(err); }
      <span class="keyword">if</span> (!token) { <span class="keyword">return</span> <span class="title function_">done</span>(<span class="literal">null</span>, <span class="literal">false</span>); }
      <span class="title class_">Users</span>.<span class="title function_">findById</span>(token.<span class="property">userId</span>, <span class="keyword">function</span>(<span class="params">err, user</span>) {
        <span class="keyword">if</span> (err) { <span class="keyword">return</span> <span class="title function_">done</span>(err); }
        <span class="keyword">if</span> (!user) { <span class="keyword">return</span> <span class="title function_">done</span>(<span class="literal">null</span>, <span class="literal">false</span>); }
        <span class="comment">// fourth argument is optional info.  typically used to pass</span>
        <span class="comment">// details needed to authorize the request (ex: `scope`)</span>
        <span class="keyword">return</span> <span class="title function_">done</span>(<span class="literal">null</span>, user, token.<span class="property">secret</span>, { <span class="attr">scope</span>: token.<span class="property">scope</span> });
      });
    });
  },
  <span class="keyword">function</span>(<span class="params">timestamp, nonce, done</span>) {
    <span class="comment">// validate the timestamp and nonce as necessary</span>
    <span class="title function_">done</span>(<span class="literal">null</span>, <span class="literal">true</span>)
  }
));
</code></pre>
<p>In contrast to other strategies, there are two callbacks required by OAuth.  In
OAuth, both an identifier for the requesting application and the user-specific
token are encoded as credentials.</p>
<p>The first callback is known as the &quot;consumer callback&quot;, and is used to find the
application making the request, including the secret assigned to it.  The second
callback is the &quot;token callback&quot;, which is used to identify the user as well as
the token&#39;s corresponding secret.  The secrets supplied by the consumer and
token callbacks are used to compute a signature, and authentication fails if it
does not match the request signature.</p>
<p>A final &quot;validate callback&quot; is optional, which can be used to prevent replay
attacks by checking the timestamp and nonce used in the request.</p>
<h2 id="protect-endpoints">Protect Endpoints</h2>
<pre><code class="javascript">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/me&#x27;</span>,
  passport.<span class="title function_">authenticate</span>(<span class="string">&#x27;token&#x27;</span>, { <span class="attr">session</span>: <span class="literal">false</span> }),
  <span class="keyword">function</span>(<span class="params">req, res</span>) {
    res.<span class="title function_">json</span>(req.<span class="property">user</span>);
  });
</code></pre>
<p>Specify <code>passport.authenticate()</code> with the <code>token</code> strategy to protect API
endpoints.  Sessions are not typically needed by APIs, so they can be disabled.</p>
</section>
          </div>
        </div>
      </div>
    </div>
    <div class="search-con">
      <div class="head"><span class="close-ico"></span>
        <div class="hold">
          <h2>SEARCH FOR STRATEGIES</h2>
          <form action="/">
            <input value="" type="text" name="strategy" placeholder="Start typing" autocomplete="off">
          </form>
          <p class="info-line"><span>0</span>STRATEGIES</p>
        </div>
      </div>
      <div class="results">
        <section></section>
      </div>
    </div>
    <!--+google-tag-manager-noscript('GTM-M5S3PH')-->
  </body>
</html>