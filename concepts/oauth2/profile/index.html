<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
  <head>
    <title>Understanding OAuth 2.0: Profile</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="canonical" href="https://www.passportjs.org/concepts/oauth2/profile/">
    <link rel="manifest" href="/manifest.webmanifest"/>
    <meta name="theme-color" content="#35DF79"/>
    <link rel="shortcut icon" href="/images/favicon/favicon.ico"/>
    <link rel="icon" sizes="16x16" type="image/png" href="/images/favicon/favicon-16x16.png"/>
    <link rel="icon" sizes="32x32" type="image/png" href="/images/favicon/favicon-32x32.png"/>
    <link rel="icon" sizes="36x36" type="image/png" href="/images/favicon/android-icon-36x36.png"/>
    <link rel="icon" sizes="48x48" type="image/png" href="/images/favicon/android-icon-48x48.png"/>
    <link rel="icon" sizes="70x70" type="image/png" href="/images/favicon/ms-icon-70x70.png"/>
    <link rel="icon" sizes="72x72" type="image/png" href="/images/favicon/android-icon-72x72.png"/>
    <link rel="icon" sizes="96x96" type="image/png" href="/images/favicon/android-icon-96x96.png"/>
    <link rel="icon" sizes="144x144" type="image/png" href="/images/favicon/ms-icon-144x144.png"/>
    <link rel="icon" sizes="150x150" type="image/png" href="/images/favicon/ms-icon-150x150.png"/>
    <link rel="icon" sizes="192x192" type="image/png" href="/images/favicon/android-icon-192x192.png"/>
    <link rel="icon" sizes="310x310" type="image/png" href="/images/favicon/ms-icon-310x310.png"/>
    <link rel="apple-touch-icon" href="/images/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png"/>
    <meta name="msapplication-config" content="/browserconfig.xml"/>
    <meta name="msapplication-TileColor" content="#35DF79"/>
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="Understanding OAuth 2.0: Profile"/>
    <meta property="og:url" content="https://www.passportjs.org/concepts/oauth2/profile/"/>
    <meta property="og:image" content="https://www.passportjs.org/images/facebook-card.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:site_name" content="Passport.js"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@passportjs"/>
    <meta name="twitter:title" content="Understanding OAuth 2.0: Profile"/>
    <meta name="twitter:image" content="https://www.passportjs.org/images/twitter-card.png"/>
    <meta name="flattr:id" content="d5znvd"/>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-73332146-2', 'auto');
      ga('send', 'pageview');
    </script>
    <!--+google-tag-manager('GTM-M5S3PH')-->
    <!--link(type='text/css', rel='stylesheet', href='http://fast.fonts.net/cssapi/7527d73a-ebfe-45db-a201-ff2812df4b18.css')-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <link rel="stylesheet" href="/assets/styles/all.css">
    <script data-main="/script/main" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.js"></script>
  </head>
  <body>
    <div id="container"><span id="top"></span>
      <div id="toolbar">
        <div class="toolbar-search">
          <form action="/search">
            <button type="submit"></button>
            <input type="text" name="q" placeholder="Search for Strategies">
          </form>
        </div>
        <div class="toolbar-social">
          <ul>
            <li class="facebook"><a href="https://www.facebook.com/passportjs" target="_blank"></a></li>
            <li class="twitter"><a href="https://twitter.com/passportjs" target="_blank"></a></li>
            <li class="github"><a href="https://github.com/jaredhanson/passport" target="_blank"><span class="count">0</span></a></li>
          </ul>
        </div>
      </div>
      <nav id="menu"><a class="menu-logo" href="/" title="Passport.js"></a>
        <div class="menu-trigger"><span></span></div>
        <div class="menu-items">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="/features/">Features</a></li>
            <li><a href="/packages/">Strategies</a></li>
            <li><a href="/sponsors/">Sponsors</a></li>
          </ul><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=passportjsorg" id="_carbonads_js"></script>
        </div>
      </nav>
      <div id="content">
        <div class="book" id="book">
          <div class="toc">
            <nav data-accordion-group="">
              <div class="accordion" data-accordion="">
                <h5 data-control=""><i class="icon-budicon-461"></i><a href="/concepts/oauth2/"></a></h5>
                <ul data-content="">
                  <li><a href="/concepts/oauth2/">Introduction</a></li>
                  <li><a href="/concepts/oauth2/terminology/">Terminology</a></li>
                  <li><a href="/concepts/oauth2/flow/">Protocol Flow</a></li>
                  <li><a href="/concepts/oauth2/authorization/">Authorization</a></li>
                  <li><a href="/concepts/oauth2/token/">Token</a></li>
                  <li><a class="active" href="/concepts/oauth2/profile/">Profile</a></li>
                  <li><a href="/concepts/oauth2/authentication/">Authentication</a></li>
                </ul>
              </div>
            </nav>
          </div><a id="go-top" href="#top"><i class="icon-budicon-462"></i></a>
          <div class="contents">
            <section class="chapter"><h1 id="accessing-user-profile">Accessing User Profile</h1>
<p>Now that the application has been issued an access token, it can use that token
to make authenticated API requests.  We&#39;ll explore how that is accomplished in
this chapter.</p>
<p>Before we begin, it should be noted that the OAuth 2.0 protocol aspects of the
sequence are complete.  OAuth 2.0 is used to obtain authorization from the user
(which was done with the <a href="../authorization/">authorization request and response</a>)
and exchange that authorization for an access token (which was done with the
<a href="../token/">token request and response</a>).  At this point, the sequence is transitioning to use HTTP and the
authentication features of that protocol.</p>
<p>Passport now makes a request to the Facebook Graph API, in particular the
<a href="https://developers.facebook.com/docs/graph-api/overview/#me"><code>/me</code></a> node, which
returns data about the <a href="https://developers.facebook.com/docs/graph-api/reference/user/">user</a>
whose access token is used to authenticate the API request:</p>
<pre><code class="lang-http"><span class="keyword">POST</span> <span class="string">/v3.2/me</span> HTTP/1.1
<span class="attribute">Host</span>: graph.facebook.com
<span class="attribute">Authorization</span>: Bearer IAxLF5woqmfjTCHRD6gnp9X9RNVK3TG0
</code></pre>
<p>Note that the access token that was just issued is being used as a credential in
the <code>Authorization</code> header.  Because the token is a bearer token, it is utilized
by simply including the access token string in the request according to the
<code>Bearer</code> scheme, as specified by <a href="https://datatracker.ietf.org/doc/html/rfc6750">RFC 6750</a>.</p>
<p>Just as different types of tokens can be returned in the OAuth 2.0 token
response, the HTTP authentication framework allows for an extensible set of
schemes that specify how to include credentials in a request.  This guide only
examines bearer tokens, as they are the most common token type in use today.</p>
<p>When Facebook receives this request, it verifies that the access token is valid
and that the authorization granted permits access to the resource.  If so,
Facebook responds with information about the user.</p>
<pre><code class="lang-http">HTTP/1.1 <span class="number">200</span> OK
<span class="attribute">Content-Type</span>: application/json

<span class="json">{
  <span class="attr">"name"</span>: <span class="string">"Alice Smith"</span>,
  <span class="attr">"id"</span>: <span class="string">"14818013739641407"</span>
}</span>
</code></pre>
<p>Keep in mind that at this point Passport is still processing the authorization
response using a route:</p>
<pre><code class="lang-js">router.get(<span class="string">'/oauth2/redirect/facebook'</span>, passport.authenticate(<span class="string">'facebook'</span>, {
  <span class="attr">successReturnToOrRedirect</span>: <span class="string">'/'</span>,
  <span class="attr">failureRedirect</span>: <span class="string">'/login'</span>
}));
</code></pre>
<p>The user request is interleaved in the middle of processing the authorization
response, after the prior token request.  A visualization of of the requests and
responses that have occured up to this point looks as follows:</p>
<pre><code class="lang-sh">+-----+ &lt;-- POST /oauth2/redirect/facebook --- +---------+
|     |                                        |         |
|     |   ----- Token Request  -----&gt; +-----+  |         |
|     |   &lt;---- Token Response ------ | AS  |  |         |
| App |                               +-----+  | Browser |
|     |   ------ User Request  -----&gt; +-----+  |         |
|     |   &lt;----- User Response ------ | API |  |         |
|     |                               +-----+  |         |
|     |   ...additional processing...          |         |
+-----+                                        +---------+
</code></pre>
<p>Now that Passport has obtained the user profile, it can <a href="../authentication/">authenticate the user</a>.</p>
</section>
          </div>
        </div>
      </div>
    </div>
    <div class="search-con">
      <div class="head"><span class="close-ico"></span>
        <div class="hold">
          <h2>SEARCH FOR STRATEGIES</h2>
          <form action="/">
            <input value="" type="text" name="strategy" placeholder="Start typing" autocomplete="off">
          </form>
          <p class="info-line"><span>0</span>STRATEGIES</p>
        </div>
      </div>
      <div class="results">
        <section></section>
      </div>
    </div>
    <!--+google-tag-manager-noscript('GTM-M5S3PH')-->
  </body>
</html>