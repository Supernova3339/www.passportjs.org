<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
  <head>
    <title>passport-outlook</title>
    <meta charset="utf-8">
    <meta name="description" content="Outlook REST API v2 authentication strategy for Passport.">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="canonical" href="https://www.passportjs.org/packages/passport-outlook/">
    <link rel="manifest" href="/manifest.webmanifest"/>
    <meta name="theme-color" content="#35DF79"/>
    <link rel="shortcut icon" href="/images/favicon/favicon.ico"/>
    <link rel="icon" sizes="16x16" type="image/png" href="/images/favicon/favicon-16x16.png"/>
    <link rel="icon" sizes="32x32" type="image/png" href="/images/favicon/favicon-32x32.png"/>
    <link rel="icon" sizes="36x36" type="image/png" href="/images/favicon/android-icon-36x36.png"/>
    <link rel="icon" sizes="48x48" type="image/png" href="/images/favicon/android-icon-48x48.png"/>
    <link rel="icon" sizes="70x70" type="image/png" href="/images/favicon/ms-icon-70x70.png"/>
    <link rel="icon" sizes="72x72" type="image/png" href="/images/favicon/android-icon-72x72.png"/>
    <link rel="icon" sizes="96x96" type="image/png" href="/images/favicon/android-icon-96x96.png"/>
    <link rel="icon" sizes="144x144" type="image/png" href="/images/favicon/ms-icon-144x144.png"/>
    <link rel="icon" sizes="150x150" type="image/png" href="/images/favicon/ms-icon-150x150.png"/>
    <link rel="icon" sizes="192x192" type="image/png" href="/images/favicon/android-icon-192x192.png"/>
    <link rel="icon" sizes="310x310" type="image/png" href="/images/favicon/ms-icon-310x310.png"/>
    <link rel="apple-touch-icon" href="/images/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png"/>
    <meta name="msapplication-config" content="/browserconfig.xml"/>
    <meta name="msapplication-TileColor" content="#35DF79"/>
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="passport-outlook"/>
    <meta property="og:description" content="Outlook REST API v2 authentication strategy for Passport."/>
    <meta property="og:url" content="https://www.passportjs.org/packages/passport-outlook/"/>
    <meta property="og:image" content="https://www.passportjs.org/images/facebook-card.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:site_name" content="Passport.js"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@passportjs"/>
    <meta name="twitter:title" content="passport-outlook"/>
    <meta name="twitter:description" content="Outlook REST API v2 authentication strategy for Passport."/>
    <meta name="twitter:image" content="https://www.passportjs.org/images/twitter-card.png"/>
    <meta name="flattr:id" content="d5znvd"/>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-73332146-2', 'auto');
      ga('send', 'pageview');
    </script>
    <!--+google-tag-manager('GTM-M5S3PH')-->
    <!--link(type='text/css', rel='stylesheet', href='http://fast.fonts.net/cssapi/7527d73a-ebfe-45db-a201-ff2812df4b18.css')-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <link rel="stylesheet" href="/assets/styles/all.css">
    <script data-main="/script/main" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.js"></script>
  </head>
  <body>
    <div id="container"><span id="top"></span>
      <div id="toolbar">
        <div class="toolbar-search">
          <form action="/search">
            <button type="submit"></button>
            <input type="text" name="q" placeholder="Search for Strategies">
          </form>
        </div>
        <div class="toolbar-social">
          <ul>
            <li class="facebook"><a href="https://www.facebook.com/passportjs" target="_blank"></a></li>
            <li class="twitter"><a href="https://twitter.com/passportjs" target="_blank"></a></li>
            <li class="github"><a href="https://github.com/jaredhanson/passport" target="_blank"><span class="count">0</span></a></li>
          </ul>
        </div>
      </div>
      <nav id="menu"><a class="menu-logo" href="/" title="Passport.js"></a>
        <div class="menu-trigger"><span></span></div>
        <div class="menu-items">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="/features/">Features</a></li>
            <li><a href="/packages/">Strategies</a></li>
            <li><a href="/sponsors/">Sponsors</a></li>
          </ul><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=passportjsorg" id="_carbonads_js"></script>
        </div>
      </nav>
      <div id="content">
        <div class="package hproduct" id="package">
          <div class="description"><h1 id="passport-outlook">passport-outlook</h1>
<p><a href="https://travis-ci.org/clocked0ne/passport-outlook"><img src="https://travis-ci.org/clocked0ne/passport-outlook.svg" alt="Build Status"></a></p>
<p><a href="https://github.com/jaredhanson/passport">Passport</a> strategy for authenticating
with <a href="http://www.outlook.com/">Outlook</a> accounts (aka <a href="http://www.live.com/">Windows Live</a>)
using the OAuth 2.0 API.</p>
<p>This module lets you authenticate using Outlook REST API v2 in your Node.js
applications. By plugging into Passport, Outlook REST API v2 authentication
can be easily and unobtrusively integrated into any application or
framework that supports <a href="http://www.senchalabs.org/connect/">Connect</a>-style
middleware, including <a href="http://expressjs.com/">Express</a>.</p>
<p>Unlike alternative modules, this package authenticates against the latest
Outlook.com (Office 365) v2 endpoints as can be tested in their
<a href="https://oauthplay.azurewebsites.net/">Outlook Dev Center OAuth Sandbox</a></p>
<h2 id="install">Install</h2>
<pre><code class="lang-bash">$ npm install --save passport-outlook
</code></pre>
<h2 id="usage">Usage</h2>
<h4 id="v3">v3</h4>
<p>There are no behavioural changes but as of v3 the minimum required NodeJS version
is v10. This should not affect most users but is a breaking change nonetheless.</p>
<h4 id="upgrading-for-v2">Upgrading for v2</h4>
<p>If you were using the package before <code>v2.0.0</code>, please note that the <code>profile</code>
JSON returned has been updated to match the normalized contact schema outlined
by <a href="http://passportjs.org/docs/profile">Passport</a> and used by other strategies.</p>
<p>Therefore, you will need to update your application to match these modified JSON
properties.</p>
<h4 id="create-an-application">Create an Application</h4>
<p>Before using <code>passport-outlook</code>, you must register an application with Microsoft.
If you have not already done so, a new application can be created at the
<a href="https://apps.dev.microsoft.com/">Application Registration Portal</a>. Your
application will be issued a client ID and client secret, which need to be
provided to the strategy. You will also need to configure a redirect URL which
matches the route in your application.</p>
<h4 id="configure-strategy">Configure Strategy</h4>
<p>The Outlook REST API v2 authentication strategy authenticates users using an
Outlook.com account and OAuth 2.0 tokens.  The strategy requires a <code>verify</code>
callback, which accepts these credentials and calls <code>done</code> providing a user,
as well as <code>options</code> specifying a client ID, client secret, and callback URL.</p>
<pre><code class="lang-js">passport.use(<span class="keyword">new</span> OutlookStrategy({
    <span class="attr">clientID</span>: OUTLOOK_CLIENT_ID,
    <span class="attr">clientSecret</span>: OUTLOOK_CLIENT_SECRET,
    <span class="attr">callbackURL</span>: <span class="string">'http://www.example.com/auth/outlook/callback'</span>
  },
  <span class="function"><span class="keyword">function</span>(<span class="params">accessToken, refreshToken, profile, done</span>) </span>{
    <span class="keyword">var</span> user = {
      <span class="attr">outlookId</span>: profile.id,
      <span class="attr">name</span>: profile.DisplayName,
      <span class="attr">email</span>: profile.EmailAddress,
      <span class="attr">accessToken</span>:  accessToken
    };
    <span class="keyword">if</span> (refreshToken)
      user.refreshToken = refreshToken;
    <span class="keyword">if</span> (profile.MailboxGuid)
      user.mailboxGuid = profile.MailboxGuid;
    <span class="keyword">if</span> (profile.Alias)
      user.alias = profile.Alias;
    User.findOrCreate(user, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>{
      <span class="keyword">return</span> done(err, user);
    });
  }
));
</code></pre>
<p>Additional options are supported as part of the described 
<a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-implicit-grant-flow">implicit grant flow</a>:
<code>prompt</code>, <code>login_hint</code> &amp; <code>domain_hint</code>.</p>
<p><em>Note:</em>
If you want to use the express request, you must use the option
<code>passReqToCallback: true</code>, then Passport will send the request as the first parameter.</p>
<pre><code class="lang-js">passport.use(<span class="keyword">new</span> OutlookStrategy({
    <span class="attr">clientID</span>: OUTLOOK_CLIENT_ID,
    <span class="attr">clientSecret</span>: OUTLOOK_CLIENT_SECRET,
    <span class="attr">callbackURL</span>: <span class="string">'http://www.example.com/auth/outlook/callback'</span>,
    <span class="attr">passReqToCallback</span>: <span class="literal">true</span>
  },
  <span class="function"><span class="keyword">function</span>(<span class="params">req, accessToken, refreshToken, profile, done</span>) </span>{
    <span class="keyword">var</span> user = {
      <span class="attr">outlookId</span>: profile.id,
      <span class="attr">name</span>: profile.DisplayName,
      <span class="attr">email</span>: profile.EmailAddress,
      <span class="attr">accessToken</span>:  accessToken
    };
    <span class="keyword">if</span> (refreshToken)
      user.refreshToken = refreshToken;
    <span class="keyword">if</span> (profile.MailboxGuid)
      user.mailboxGuid = profile.MailboxGuid;
    <span class="keyword">if</span> (profile.Alias)
      user.alias = profile.Alias;
    User.findOrCreate(user, <span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>{
      <span class="keyword">return</span> done(err, user);
    });
  }
));
</code></pre>
<h4 id="authenticate-requests">Authenticate Requests</h4>
<p>Use <code>passport.authenticate()</code>, specifying the <code>&#39;windowslive&#39;</code> (or custom named)
strategy, to authenticate requests.</p>
<p>For example, as route middleware in an <a href="http://expressjs.com/">Express</a>
application:</p>
<pre><code class="lang-js">app.get(<span class="string">'/auth/outlook'</span>,
  passport.authenticate(<span class="string">'windowslive'</span>, {
    <span class="attr">scope</span>: [
      <span class="string">'openid'</span>,
      <span class="string">'profile'</span>,
      <span class="string">'offline_access'</span>,
      <span class="string">'https://outlook.office.com/Mail.Read'</span>
    ]
  })
);

app.get(<span class="string">'/auth/outlook/callback'</span>, 
  passport.authenticate(<span class="string">'windowslive'</span>, { <span class="attr">failureRedirect</span>: <span class="string">'/login'</span> }),
  <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>{
    <span class="comment">// Successful authentication, redirect home.</span>
    res.redirect(<span class="string">'/'</span>);
  });
</code></pre>
<p><em>Note:</em>
REST API specific scopes you are using must be fully qualified to match the
outlook domain, e.g: <code>https://outlook.office.com/Mail.Read</code> instead of <code>Mail.Read</code>
This is very important, otherwise you will receive <code>401</code> responses.</p>
<p><code>&#39;offline_access&#39;</code> is a required scope in order to obtain a
<code>refresh_token</code>. More information is available in the <a href="https://msdn.microsoft.com/en-us/office/office365/api/use-outlook-rest-api#get-an-access-token">MSDN Dev Center</a>.</p>
<h4 id="customising-endpoints">Customising endpoints</h4>
<p>If you need to customise the URLs used by the strategy (such as
connecting to the <a href="https://developer.microsoft.com/en-us/graph">Microsoft Graph</a>
API instead of Office365 REST) this is possible by modifying the
<code>options</code> passed to the strategy:</p>
<pre><code class="lang-js">passport.use(<span class="keyword">new</span> OutlookStrategy({
    <span class="attr">clientID</span>: OUTLOOK_CLIENT_ID,
    <span class="attr">clientSecret</span>: OUTLOOK_CLIENT_SECRET,
    <span class="attr">callbackURL</span>: <span class="string">'http://www.example.com/auth/graph/callback'</span>,
    <span class="attr">userProfileURL</span>: <span class="string">'https://graph.microsoft.com/v1.0/me?$select=userPrincipalName'</span>,
    <span class="attr">name</span>: <span class="string">'msgraph'</span>
  },
  <span class="function"><span class="keyword">function</span>(<span class="params">accessToken, refreshToken, profile, done</span>) </span>{
     <span class="comment">// Callback logic as per examples</span>
  }
));
</code></pre>
<p>In the example above the strategy <code>name</code> is changeed from the default of <code>&#39;windowslive&#39;</code>
to <code>&#39;msgraph&#39;</code> and the <code>userProfileURL</code> is changed to the correct Microsoft Graph
API endpoint. If you make this change, please remember to use the appropriate scopes
for the API.</p>
<h2 id="examples">Examples</h2>
<p>For a complete, working example, refer to the <a href="https://github.com/clocked0ne/passport-outlook/tree/master/examples/login">login example</a>.</p>
<h2 id="tests">Tests</h2>
<p>Any system can run the test suite in development from the terminal.</p>
<pre><code class="lang-bash">$ npm install
$ npm <span class="built_in">test</span>
</code></pre>
<h2 id="contributing">Contributing</h2>
<h4 id="tests">Tests</h4>
<p>The test suite is located in the <code>test/</code> directory. All new features are
expected to have corresponding test cases. Ensure that the complete test suite
passes by executing:</p>
<pre><code class="lang-bash">$ make <span class="built_in">test</span>
</code></pre>
<h4 id="coverage">Coverage</h4>
<p>All new features are expected to have test coverage. Patches that
increase test coverage are happily accepted. Coverage reports can be viewed by
executing:</p>
<pre><code class="lang-bash">$ make <span class="built_in">test</span>-cov
$ make view-cov
</code></pre>
<h2 id="credits">Credits</h2>
<ul>
<li><a href="https://github.com/clocked0ne">Nigel Horton</a></li>
<li><a href="https://github.com/jaredhanson">Jared Hanson</a></li>
</ul>
<h3 id="additional-contributors">Additional Contributors</h3>
<ul>
<li><a href="https://github.com/http-teapot">Thomas Potaire</a></li>
<li><a href="https://github.com/DJphilomath">DJphilomath</a></li>
<li><a href="https://github.com/andreider04">Andrés González</a></li>
<li><a href="https://github.com/dperry">Dan Perry</a></li>
<li><a href="https://github.com/Linkaynn">Jesé Romero Arbelo</a></li>
</ul>
<h2 id="license">License</h2>
<p><a href="http://opensource.org/licenses/MIT">The MIT License</a></p>
<p>Copyright (c) 2015-2019 Nigel Horton</p>
</div>
          <div class="metadata">
            <div class="install"><code>npm install <span class="fn">passport-outlook</span></code></div>
            <ul>
              <li><span class="version">3.0.0</span> published <abbr class="updated" title="2022-06-23T13:15:04Z">a month ago</abbr></li>
              <li><a class="url" href="https://github.com/clocked0ne/passport-outlook">https://github.com/clocked0ne/passport-outlook#readme</a></li>
            </ul>
            <ul>
              <li><b>169</b> downloads in the last day</li>
              <li><b>878</b> downloads in the last week</li>
              <li><b>4,022</b> downloads in the last month</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="search-con">
      <div class="head"><span class="close-ico"></span>
        <div class="hold">
          <h2>SEARCH FOR STRATEGIES</h2>
          <form action="/">
            <input value="" type="text" name="strategy" placeholder="Start typing" autocomplete="off">
          </form>
          <p class="info-line"><span>0</span>STRATEGIES</p>
        </div>
      </div>
      <div class="results">
        <section></section>
      </div>
    </div>
    <!--+google-tag-manager-noscript('GTM-M5S3PH')-->
  </body>
</html>