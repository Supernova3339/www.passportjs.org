<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#" lang="en">
  <head>
    <title>passport-magic-link</title>
    <meta charset="utf-8">
    <meta name="description" content="Passport JS module for Magic Link authentication">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="canonical" href="https://www.passportjs.org/packages/passport-magic-link/">
    <link rel="manifest" href="/manifest.webmanifest"/>
    <meta name="theme-color" content="#35DF79"/>
    <link rel="shortcut icon" href="/images/favicon/favicon.ico"/>
    <link rel="icon" sizes="16x16" type="image/png" href="/images/favicon/favicon-16x16.png"/>
    <link rel="icon" sizes="32x32" type="image/png" href="/images/favicon/favicon-32x32.png"/>
    <link rel="icon" sizes="36x36" type="image/png" href="/images/favicon/android-icon-36x36.png"/>
    <link rel="icon" sizes="48x48" type="image/png" href="/images/favicon/android-icon-48x48.png"/>
    <link rel="icon" sizes="70x70" type="image/png" href="/images/favicon/ms-icon-70x70.png"/>
    <link rel="icon" sizes="72x72" type="image/png" href="/images/favicon/android-icon-72x72.png"/>
    <link rel="icon" sizes="96x96" type="image/png" href="/images/favicon/android-icon-96x96.png"/>
    <link rel="icon" sizes="144x144" type="image/png" href="/images/favicon/ms-icon-144x144.png"/>
    <link rel="icon" sizes="150x150" type="image/png" href="/images/favicon/ms-icon-150x150.png"/>
    <link rel="icon" sizes="192x192" type="image/png" href="/images/favicon/android-icon-192x192.png"/>
    <link rel="icon" sizes="310x310" type="image/png" href="/images/favicon/ms-icon-310x310.png"/>
    <link rel="apple-touch-icon" href="/images/favicon/apple-icon-57x57.png"/>
    <link rel="apple-touch-icon" sizes="60x60" href="/images/favicon/apple-icon-60x60.png"/>
    <link rel="apple-touch-icon" sizes="72x72" href="/images/favicon/apple-icon-72x72.png"/>
    <link rel="apple-touch-icon" sizes="76x76" href="/images/favicon/apple-icon-76x76.png"/>
    <link rel="apple-touch-icon" sizes="114x114" href="/images/favicon/apple-icon-114x114.png"/>
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/apple-icon-120x120.png"/>
    <link rel="apple-touch-icon" sizes="144x144" href="/images/favicon/apple-icon-144x144.png"/>
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/apple-icon-152x152.png"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/apple-icon-180x180.png"/>
    <meta name="msapplication-config" content="/browserconfig.xml"/>
    <meta name="msapplication-TileColor" content="#35DF79"/>
    <meta name="msapplication-TileImage" content="/images/favicon/ms-icon-144x144.png"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="passport-magic-link"/>
    <meta property="og:description" content="Passport JS module for Magic Link authentication"/>
    <meta property="og:url" content="https://www.passportjs.org/packages/passport-magic-link/"/>
    <meta property="og:image" content="https://www.passportjs.org/images/facebook-card.png"/>
    <meta property="og:image:type" content="image/png"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:site_name" content="Passport.js"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@passportjs"/>
    <meta name="twitter:title" content="passport-magic-link"/>
    <meta name="twitter:description" content="Passport JS module for Magic Link authentication"/>
    <meta name="twitter:image" content="https://www.passportjs.org/images/twitter-card.png"/>
    <meta name="flattr:id" content="d5znvd"/>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-73332146-2', 'auto');
      ga('send', 'pageview');
    </script>
    <!--+google-tag-manager('GTM-M5S3PH')-->
    <!--link(type='text/css', rel='stylesheet', href='http://fast.fonts.net/cssapi/7527d73a-ebfe-45db-a201-ff2812df4b18.css')-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
    <link rel="stylesheet" href="/assets/styles/all.css">
    <script data-main="/script/main" src="//cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.js"></script>
  </head>
  <body>
    <div id="container"><span id="top"></span>
      <div id="toolbar">
        <div class="toolbar-search">
          <form action="/search">
            <button type="submit"></button>
            <input type="text" name="q" placeholder="Search for Strategies">
          </form>
        </div>
        <div class="toolbar-social">
          <ul>
            <li class="facebook"><a href="https://www.facebook.com/passportjs" target="_blank"></a></li>
            <li class="twitter"><a href="https://twitter.com/passportjs" target="_blank"></a></li>
            <li class="github"><a href="https://github.com/jaredhanson/passport" target="_blank"><span class="count">0</span></a></li>
          </ul>
        </div>
      </div>
      <nav id="menu"><a class="menu-logo" href="/" title="Passport.js"></a>
        <div class="menu-trigger"><span></span></div>
        <div class="menu-items">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/docs/">Documentation</a></li>
            <li><a href="/features/">Features</a></li>
            <li><a href="/packages/">Strategies</a></li>
            <li><a href="/sponsors/">Sponsors</a></li>
          </ul><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=passportjsorg" id="_carbonads_js"></script>
        </div>
      </nav>
      <div id="content">
        <div class="package hproduct" id="package">
          <div class="description"><h1 id="passport-magic-link">passport-magic-link</h1>
<p>Magic Link authentication for Passport JS</p>
<p><a href="https://travis-ci.org/vinialbano/passport-magic-link"><img src="https://travis-ci.org/vinialbano/passport-magic-link.svg?branch=master" alt="Build Status"></a>
<a href="https://coveralls.io/github/vinialbano/passport-magic-link?branch=master"><img src="https://coveralls.io/repos/github/vinialbano/passport-magic-link/badge.svg?branch=master" alt="Coverage Status"></a></p>
<h2 id="installation">Installation</h2>
<p>  <code>npm install passport-magic-link</code></p>
<h2 id="usage">Usage</h2>
<h3 id="configure-strategy">Configure Strategy</h3>
<p>  The MagicLinkStrategy constructor receives three parameters:</p>
<ul>
<li><code>options</code>: A javascript object containing some configuration:<ul>
<li><code>secret</code> Mandatory string, used to sign tokens</li>
<li><code>userFields</code>: An array of mandatory field names from the request query or body that are going to be used to create or retrieve the user.</li>
<li><code>tokenField</code>: The name of the field which contains the token in the request query or body.</li>
<li><code>ttl</code>: Optional integer, defaults to 10 minutes (in seconds). It&#39;s used to set the token expiration</li>
<li><code>passReqToCallbacks</code>: Optional boolean, defaults to false. If true, the request is passed to the <code>sendToken</code> and <code>verifyUser</code> functions.</li>
<li><code>verifyUserAfterToken</code>: Optional boolean, defaults to false. If true, the request data is passed to the token and the user is verified after the token confirmation.</li>
<li><code>storage</code>: Optional token storage instance. Defaults to MemoryStorage.</li>
</ul>
</li>
<li><code>sendToken</code>: A function that is used to deliver the token to the user. You may use an email service, SMS or whatever method you want. It receives the user object, the token and optionally the request. It returns a promise indicating whether the token has been sent or not.</li>
<li><code>verifyUser</code>: A function that receives the request and returns a promise containing the user object. It may be used to insert and/or find the user in the database. It may be executed before the token creation or after the token confirmation.</li>
</ul>
<h4 id="example">Example</h4>
<pre><code class="javascript">    <span class="keyword">const</span> <span class="title class_">MagicLinkStrategy</span> = <span class="built_in">require</span>(<span class="string">&#x27;passport-magic-link&#x27;</span>).<span class="property">Strategy</span>

    passport.<span class="title function_">use</span>(<span class="keyword">new</span> <span class="title class_">MagicLinkStrategy</span>({
       <span class="attr">secret</span>: <span class="string">&#x27;my-secret&#x27;</span>,
       <span class="attr">userFields</span>: [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;email&#x27;</span>],
       <span class="attr">tokenField</span>: <span class="string">&#x27;token&#x27;</span>
    }, <span class="function">(<span class="params">user, token</span>) =&gt;</span> {
       <span class="keyword">return</span> <span class="title class_">MailService</span>.<span class="title function_">sendMail</span>({
        <span class="attr">to</span>: user.<span class="property">email</span>,
        token
       })
    }, <span class="function">(<span class="params">user</span>) =&gt;</span> {
      <span class="keyword">return</span> <span class="title class_">User</span>.<span class="title function_">findOrCreate</span>({<span class="attr">email</span>: user.<span class="property">email</span>, <span class="attr">name</span>: user.<span class="property">name</span>})
    }))
</code></pre>
<h3 id="authenticate-requests">Authenticate Requests</h3>
<p>  Use <code>passport.authenticate()</code>, specifying the <code>&#39;magiclink&#39;</code> strategy for two actions:</p>
<h4 id="request-token">request token</h4>
<p>  In this situation the passport authenticate middleware will send a token produced by the user information, which is returned by the <code>verifyUser</code> function. The delivery system is not provided by default and must be placed in the <code>sendToken</code> function.</p>
<pre><code class="javascript">  app.<span class="title function_">post</span>(<span class="string">&#x27;/auth/magiclink&#x27;</span>,
      passport.<span class="title function_">authenticate</span>(<span class="string">&#x27;magiclink&#x27;</span>, { action : <span class="string">&#x27;requestToken&#x27;</span> }),
      <span class="function">(<span class="params">req, res</span>) =&gt;</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/check-your-inbox&#x27;</span>)
  )
</code></pre>
<h4 id="accept-token">accept token</h4>
<p>  In this situation (the default) the passport authenticate middleware will check for a token. The token value is returned by the <code>verifyToken</code> function.</p>
<pre><code class="javascript">  app.<span class="title function_">get</span>(<span class="string">&#x27;/auth/magiclink/callback&#x27;</span>,
    passport.<span class="title function_">authenticate</span>(<span class="string">&#x27;magiclink&#x27;</span>, { action : <span class="string">&#x27;acceptToken&#x27;</span> }),
    <span class="function">(<span class="params">req, res</span>) =&gt;</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/profile&#x27;</span>)
  )
</code></pre>
<p>  The options field can also receive some optional properties:</p>
<ul>
<li><code>allowReuse</code>: A boolean indicating whether a token can be used more than once. Defaults to <code>false</code>.</li>
<li><code>userPrimaryKey</code>: A string containing the primary key of the user object. This is only used if the token cannot be reused. Defaults to <code>email</code>.</li>
<li><p><code>tokenAlreadyUsedMessage</code>: A string containing the error message if the token has already been used. Defaults to <code>Token was already used</code>.</p>
<pre><code class="javascript">app.<span class="title function_">get</span>(<span class="string">&#x27;/auth/magiclink/callback&#x27;</span>,
passport.<span class="title function_">authenticate</span>(<span class="string">&#x27;magiclink&#x27;</span>, {
  action : <span class="string">&#x27;acceptToken&#x27;</span>,
  <span class="attr">userPrimaryKey</span>: <span class="string">&#x27;id&#x27;</span>
 }),
<span class="function">(<span class="params">req, res</span>) =&gt;</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/profile&#x27;</span>)
)
</code></pre>
</li>
</ul>
<h2 id="acknowledgements">Acknowledgements</h2>
<p>  This module is forked and modified from <a href="https://github.com/nickbalestra/zero">Nick Balestra&#39;s Passport Zero</a></p>
</div>
          <div class="metadata">
            <div class="install"><code>npm install <span class="fn">passport-magic-link</span></code></div>
            <ul>
              <li><span class="version">2.1.0</span> published <abbr class="updated" title="2022-05-12T15:47:50Z">a year ago</abbr></li>
              <li><a class="url" href="https://github.com/vinialbano/passport-magic-link">https://github.com/vinialbano/passport-magic-link#readme</a></li>
              <li><a rel="licence" href="http://www.opensource.org/licenses/MIT">MIT License</a></li>
            </ul>
            <ul>
              <li><b>111</b> downloads in the last day</li>
              <li><b>878</b> downloads in the last week</li>
              <li><b>2,752</b> downloads in the last month</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="search-con">
      <div class="head"><span class="close-ico"></span>
        <div class="hold">
          <h2>SEARCH FOR STRATEGIES</h2>
          <form action="/">
            <input value="" type="text" name="strategy" placeholder="Start typing" autocomplete="off">
          </form>
          <p class="info-line"><span>0</span>STRATEGIES</p>
        </div>
      </div>
      <div class="results">
        <section></section>
      </div>
    </div>
    <!--+google-tag-manager-noscript('GTM-M5S3PH')-->
  </body>
</html>